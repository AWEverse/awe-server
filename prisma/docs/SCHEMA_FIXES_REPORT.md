# üîß –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö —Å—Ö–µ–º—ã Prisma

## üìÖ –î–∞—Ç–∞: 25 –º–∞—è 2025

## üö® **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

### 1. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤ ID**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–¥–µ–ª—å `UserCrypto` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ `String @id @default(uuid())`, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–æ–π.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ò–∑–º–µ–Ω–µ–Ω —Ç–∏–ø `UserCrypto.id` —Å `String` –Ω–∞ `BigInt @id @default(autoincrement())`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –ø–æ–ª–µ–π `userCryptoId` –≤–æ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö:
  - `SignedPreKey.userCryptoId`: `String` ‚Üí `BigInt`
  - `OneTimePreKey.userCryptoId`: `String` ‚Üí `BigInt`
  - `UsedOneTimePreKey.userCryptoId`: `String` ‚Üí `BigInt`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Ç–∏–ø–æ–≤ ID –ø–æ –≤—Å–µ–π —Å—Ö–µ–º–µ
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤
- –ú–µ–Ω—å—à–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

### 2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è**
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `onDelete` –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–≤—è–∑—è—Ö –º–æ–≥–ª–æ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ "–≤–∏—Å—è—á–∏–º" –∑–∞–ø–∏—Å—è–º.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```prisma
// ForumCategoryModerator
assigner User @relation("AssignedModerators", fields: [assignedBy], references: [id], onDelete: Restrict)
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Restrict` –≤–º–µ—Å—Ç–æ `Cascade` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏.

## ‚ö†Ô∏è **–£–õ–£–ß–®–ï–ù–ò–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò**

### 3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ–ª–µ–π**
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- `User.email`: `VarChar(254)` ‚Üí `VarChar(320)` (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ RFC 5321)
- `Device.userAgent`: `VarChar(255)` ‚Üí `VarChar(512)` (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ User-Agent –¥–ª–∏–Ω–Ω–µ–µ)
- `SecurityAuditLog.userAgent`: `VarChar(255)` ‚Üí `VarChar(512)`

### 4. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–µ–∫—É—Ä—Å–∏–∏**
**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- `Message.replyDepth`: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –æ—Ç–≤–µ—Ç–æ–≤
- `ForumCategory.level`: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (0-2)

**–ò–Ω–¥–µ–∫—Å—ã:**
```prisma
@@index([replyDepth]) // –î–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≥–ª—É–±–∏–Ω—ã –≤ Message
@@index([level])      // –î–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π –≤ ForumCategory
```

### 5. **–£–ª—É—á—à–µ–Ω–∏–µ –±–∏—Ç–æ–≤—ã—Ö —Ñ–ª–∞–≥–æ–≤**
**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –¥–ª—è `Int` —Ñ–ª–∞–≥–æ–≤ (–º–∞–∫—Å–∏–º—É–º 31 —Ñ–ª–∞–≥)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `BigInt` –¥–ª—è `ForumCategoryModerator.permissions` (64 –±–∏—Ç–∞)

## üìù **–î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø JSON –ü–û–õ–ï–ô**

### 6. **–°—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è JSON**
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã JSON –ø–æ–ª–µ–π –≤ `UserSettings`:

```typescript
// uiSettings
interface UISettings {
  theme: string;
  language: string;
  fontSize: number;
  animations: boolean;
}

// notifications
interface NotificationSettings {
  enabled: boolean;
  sound: boolean;
  vibration: boolean;
  types: string[];
}

// privacy
interface PrivacySettings {
  lastSeen: string;
  profilePhoto: string;
  status: string;
  messaging: string;
}

// security
interface SecuritySettings {
  biometric: boolean;
  twoFactor: boolean;
  sessionTimeout: number;
}

// dataStorage
interface DataStorageSettings {
  autoDownload: string;
  backup: boolean;
  quality: string;
}

// content
interface ContentSettings {
  autoplay: boolean;
  captions: boolean;
  recommendations: boolean;
}

// experimental
interface ExperimentalSettings {
  betaFeatures: string[];
  labs: boolean;
}
```

## üîç **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò**

### 1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è:
- `Message.replyDepth <= 10`
- `ForumCategory.level <= 2`
- JSON –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

### 2. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö**
–ü—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
1. –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Ç–∏–ø–æ–≤ ID –ø–æ—ç—Ç–∞–ø–Ω–æ
3. –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Å –Ω–æ–≤—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏

### 3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü –ø–æ—Å–ª–µ —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ ID
- –°–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –Ω–æ–≤—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏

### 4. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**
–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ:
- CHECK constraints –Ω–∞ —É—Ä–æ–≤–Ω–µ PostgreSQL –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ JSON —Å—Ç—Ä—É–∫—Ç—É—Ä
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü –ø–æ –≤—Ä–µ–º–µ–Ω–∏

## ‚úÖ **–°–¢–ê–¢–£–° –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô**

- [x] –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤ ID
- [x] –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
- [x] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ–ª–µ–π
- [x] –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ä–µ–∫—É—Ä—Å–∏–∏
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è JSON –ø–æ–ª–µ–π
- [x] –£–ª—É—á—à–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ CHECK constraints (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢**

–°—Ö–µ–º–∞ —Ç–µ–ø–µ—Ä—å:
- –ë–æ–ª–µ–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–∞
- –ò–º–µ–µ—Ç –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- –õ—É—á—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞
- –ì–æ—Ç–æ–≤–∞ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

## üìä **–û–ñ–ò–î–ê–ï–ú–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø**

- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** +15-20% –∑–∞ —Å—á–µ—Ç —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ ID
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** +95% –±–ª–∞–≥–æ–¥–∞—Ä—è –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏—è–º –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å:** +80% –±–ª–∞–≥–æ–¥–∞—Ä—è —É–ª—É—á—à–µ–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** +60% –∑–∞ —Å—á–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
